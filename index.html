<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF Gallery — Optimized View</title>
  <style>
    :root {
      --card-bg: #fff;
      --page-bg: #f5f5f5;
      --title-bg: #eee;
      --max-width: 900px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      background: var(--page-bg);
      display: flex;
      justify-content: center;
      padding: 16px;
    }
    .wrap {
      width: 100%;
      max-width: var(--max-width);
    }
    .pdf-section {
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin: 12px 0;
      overflow: hidden;
      padding-bottom: 12px;
    }
    .pdf-title {
      background: var(--title-bg);
      padding: 12px 14px;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
    }
    .viewer {
      width: 100%;
      padding: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      background: #fafafa;
    }
    .page-canvas {
      width: 100%;
      height: auto;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      border-radius: 6px;
    }
    .placeholder {
      width: 100%;
      height: 320px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #777;
      background: linear-gradient(90deg, #f6f6f6, #efefef);
      border-radius: 6px;
    }
    .actions {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 4px;
    }
    .open-btn {
      font-size: 14px;
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid rgba(0,0,0,0.08);
      background: white;
      cursor: pointer;
      transition: background 0.2s;
    }
    .open-btn:hover {
      background: #f0f0f0;
    }
    @media (min-width: 760px) {
      .viewer { padding: 18px; }
      .placeholder { height: 400px; }
    }
    @media (max-width: 480px) {
      .placeholder { height: 260px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="pdf-section" data-pdf="doc1.pdf" data-title="2025 가을호 [소도마을 다이어리]"></section>
    <section class="pdf-section" data-pdf="doc2.pdf" data-title="2025 봄호 [이찬희는 지금도 계속]"></section>
    <section class="pdf-section" data-pdf="doc3.pdf" data-title="2025 여름호 [숨 참는 사이]"></section>
    <section class="pdf-section" data-pdf="doc4.pdf" data-title="2024 여름름 [One sip of Lazy Vision]"></section>
    <section class="pdf-section" data-pdf="doc5.pdf" data-title="2024 봄호 [폭신한 상상의 별, 니도이]"></section>
    <section class="pdf-section" data-pdf="doc6.pdf" data-title="2023 가을호 [아프로의 유진]"></section>
    <section class="pdf-section" data-pdf="doc7.pdf" data-title="2023 여름호 [다섯, 다감하고 서슴없이]"></section>
    <section class="pdf-section" data-pdf="doc8.pdf" data-title="2023 봄호 [Write your [   ]]"></section>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.worker.min.js';

    const sections = document.querySelectorAll('.pdf-section');

    // PDF 첫 페이지 미리보기
    async function renderPreview(pdfPath, viewer) {
      try {
        const loadingTask = pdfjsLib.getDocument(pdfPath);
        const pdf = await loadingTask.promise;
        const page = await pdf.getPage(1);

        const viewport = page.getViewport({ scale: 1 });
        const containerWidth = Math.min(viewer.clientWidth, window.innerWidth * 0.95);
        const scale = containerWidth / viewport.width;
        const scaledViewport = page.getViewport({ scale });

        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        const ratio = window.devicePixelRatio || 1;
        canvas.width = scaledViewport.width * ratio;
        canvas.height = scaledViewport.height * ratio;
        canvas.style.width = scaledViewport.width + 'px';
        canvas.style.height = scaledViewport.height + 'px';

        const renderContext = {
          canvasContext: context,
          viewport: scaledViewport,
          transform: [ratio, 0, 0, ratio, 0, 0]
        };
        await page.render(renderContext).promise;
        canvas.className = 'page-canvas';
        viewer.innerHTML = '';
        viewer.appendChild(canvas);
      } catch (err) {
        viewer.innerHTML = '<div style="padding:20px;color:#a00">PDF 미리보기를 불러오지 못했습니다.</div>';
      }
    }

    // PDF 전체 페이지 렌더링
    async function renderFull(pdfPath, viewer, button) {
      button.disabled = true;
      button.innerText = "로딩 중...";
      viewer.innerHTML = '';
      try {
        const loadingTask = pdfjsLib.getDocument(pdfPath);
        const pdf = await loadingTask.promise;

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const viewport = page.getViewport({ scale: 1 });
          const containerWidth = Math.min(viewer.clientWidth, window.innerWidth * 0.95);
          const scale = containerWidth / viewport.width;
          const scaledViewport = page.getViewport({ scale });

          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          const ratio = window.devicePixelRatio || 1;
          canvas.width = scaledViewport.width * ratio;
          canvas.height = scaledViewport.height * ratio;
          canvas.style.width = scaledViewport.width + 'px';
          canvas.style.height = scaledViewport.height + 'px';

          const renderContext = {
            canvasContext: context,
            viewport: scaledViewport,
            transform: [ratio, 0, 0, ratio, 0, 0]
          };
          await page.render(renderContext).promise;
          canvas.className = 'page-canvas';
          viewer.appendChild(canvas);
        }
        button.innerText = "전체 보기 완료";
      } catch (err) {
        viewer.innerHTML = '<div style="padding:20px;color:#a00">PDF 전체 보기를 불러오지 못했습니다.</div>';
        button.innerText = "다시 시도";
        button.disabled = false;
      }
    }

    // 섹션 생성
    sections.forEach(section => {
      const pdfPath = section.dataset.pdf;
      const title = section.dataset.title;

      section.innerHTML = `
        <div class="pdf-title">${title}</div>
        <div class="viewer"><div class="placeholder">미리보기를 불러오는 중...</div></div>
        <div class="actions">
          <button class="open-btn open-full">전체 보기</button>
          <button class="open-btn open-new" data-file="${pdfPath}">새 탭에서 열기</button>
        </div>
      `;

      const viewer = section.querySelector('.viewer');
      renderPreview(pdfPath, viewer);

      // 전체 보기 버튼 클릭 시 전체 페이지 렌더
      const fullBtn = section.querySelector('.open-full');
      fullBtn.addEventListener('click', () => renderFull(pdfPath, viewer, fullBtn));

      // 새 탭 열기 버튼
      const newBtn = section.querySelector('.open-new');
      newBtn.addEventListener('click', () => window.open(pdfPath, '_blank', 'noopener'));
    });
  </script>
</body>
</html>
